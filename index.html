<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Microsoft Exam Timeline</title>
  <script type="text/javascript">
    window.PlotlyConfig = { MathJaxConfig: 'local' };
  </script>
  <script
    src="https://cdn.plot.ly/plotly-3.0.1.min.js"
    integrity="sha256-oy6Be7Eh6eiQFs5M7oXuPxxm9qbJXEtTpfSI93dW16Q="
    crossorigin="anonymous"
  ></script>
</head>
<body>
  <div id="exam-timeline" style="width:100%;height:800px;"></div>
  <script type="text/javascript">
    window.PLOTLYENV = window.PLOTLYENV || {};

    // Function to parse CSV data
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',');
      const data = [];
      
      for (let i = 1; i < lines.length; i++) {
        const values = [];
        let current = '';
        let inQuotes = false;
        
        for (let j = 0; j < lines[i].length; j++) {
          const char = lines[i][j];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            values.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        values.push(current.trim());
        
        if (values.length === headers.length) {
          const row = {};
          headers.forEach((header, index) => {
            row[header.trim().replace(/"/g, '')] = values[index].replace(/"/g, '');
          });
          data.push(row);
        }
      }
      
      return data;
    }

    // Function to create the plot with data
    function createPlot(examData) {
      // Sort by date to ensure proper chronological order
      examData.sort((a, b) => new Date(a['Exam Date']) - new Date(b['Exam Date']));
      
      const dates = examData.map(exam => exam['Exam Date']);
      const titles = examData.map(exam => exam['Exam Title']);
      const examNumbers = examData.map(exam => exam['Exam Number']);

      // Numeric indices for color mapping
      const colorIndices = Array.from({ length: dates.length }, (_, i) => i);

      // Trace definition (gradient on dots, no color bar)
      const trace = {
        x: dates,
        y: titles,
        customdata: examNumbers,
        mode: "markers",
        marker: {
          color: colorIndices,
          colorscale: [[0, "#1f77b4"], [1, "#ff00ff"]],
          cmin: 0,
          cmax: dates.length - 1,
          size: 12,
          showscale: false         // Hides the color bar
        },
        hovertemplate:
          "Passed Date: %{x|%Y-%m-%d}<br>" +
          "Exam Title: %{y}<br>" +
          "Exam Number: %{customdata}<extra></extra>"
      };

      // Layout definition
      const layout = {
        margin: { t: 20, l: 150, r: 50, b: 50 },
        xaxis: {
          title: "Passed Date",
          type: "date",
          tickformat: "%Y"
        },
        yaxis: {
          title: "Exam Title",
          automargin: true
        }
      };

      // Render the plot
      Plotly.newPlot("exam-timeline", [trace], layout, { responsive: true });
    }

    // Load and process CSV data
    async function loadExamData() {
      try {
        const response = await fetch('passed_exams.csv');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const csvText = await response.text();
        const examData = parseCSV(csvText);
        createPlot(examData);
      } catch (error) {
        console.error('Error loading exam data:', error);
        
        // Display error message to user
        const errorDiv = document.getElementById('exam-timeline');
        errorDiv.innerHTML = `
          <div style="padding: 20px; text-align: center; color: #d32f2f;">
            <h3>Error Loading Data</h3>
            <p>Could not load exam data from passed_exams.csv</p>
            <p>Error: ${error.message}</p>
            <p>Please ensure the CSV file is in the same directory as this HTML file.</p>
          </div>
        `;
      }
    }

    // Load data when page loads
    document.addEventListener('DOMContentLoaded', loadExamData);
  </script>
</body>
</html>
